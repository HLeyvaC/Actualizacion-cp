CREATE OR REPLACE FUNCTION new_cp()
RETURNS void AS
$$
BEGIN
   UPDATE cat.nuevos
SET d_tipo_asenta = cat.type_settlements.id::VARCHAR
FROM cat.type_settlements
WHERE UPPER(cat.nuevos.d_tipo_asenta) = cat.type_settlements.name;

UPDATE cat.nuevos
SET d_mnpio = cat.municipalities.id::VARCHAR
FROM cat.municipalities
WHERE cat.nuevos.d_mnpio = cat.municipalities.name;

UPDATE cat.nuevos
SET d_estado = cat.states.id::VARCHAR
FROM cat.states
WHERE cat.nuevos.d_estado = cat.states.name;

UPDATE cat.nuevos
SET d_ciudad = cat.localities.id::VARCHAR
FROM cat.localities
WHERE cat.nuevos.d_ciudad = cat.localities.name;

UPDATE cat.nuevos
SET d_zona = cat.localities.ambit
FROM cat.localities
WHERE UPPER(cat.nuevos.d_zona) = cat.localities.ambit;

INSERT INTO cat.settlements (state_id, municipality_id, locality_id,type_settlement_id,postal_code,name,ambit) 
VALUES (cat.nuevos.states::INTEGER, 'value2', 'value3');

END;

